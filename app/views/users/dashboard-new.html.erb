<div class="container-fluid">
  <% if current_user.candidate? %>
    <div class="col-md-10" id="content-container" style="background-color:#f1f1f1;">
      <div class="row">
        <div class="col-md-12" style="border-bottom:1px solid #fff;">
          <div class="box-job box-job-dashboard candidate-dashboard-custom">
            <table class="table table-bordered">
              <thead>
                <th class="td_align">Vacancies Applied For</th>
                <th class="td_align">Reviewed by Client</th>
                <th class="td_align">Submitted to Client</th>
                <th class="td_align">Interview Schedules</th>
                <th class="td_align">Interview Status</th>
                <th class="td_align">Job Status</th>
              </thead>
              <tbody>
                <% @applied_jobs.each do |job| %>
                  <tr>
                    <td><%= link_to job.title, job_path(job) %></td>
                    <td><%=reviewed_by(@reviews,job)%></td>
                    <td><%=cv_download(@reviews,job)%></td>
                    <td><%=interviewed_by(job)%></td>
                    <td><%=interview_status(job)%></td>
                    <td><%= job.status_string %></td>
                    <tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
    <% if current_user.client? %>
      <% industries = [] %>
        <% job_counts = [] %>
          <% @industries.each do |industry| %>
            <% count = 0 %>
              <% industry.jobs.each do |job| %>
                <% users = UserJob.all.collect {|k| k.job_ids.include?(job.id) ? User.find(k.user_id) : []}.flatten %>
                  <% user = users.first %>
                    <% if user.present?%>
                      <% industries << industry if count == 0 %>
                        <% count += 1 %><% end %>
                      <% end %>
                      <% job_counts << count if count > 0 %><% end %>
                      <div class="col-md-10" id="content-container" style="background-color:#f1f1f1;">
                        <% industries.each_with_index do |industry, i| %>
                          <% if industry.jobs.count > 0 %>
                            <div class="row">
                              <div class="col-md-12" style="border-bottom:1px solid #fff;">
                                <div class="job-right">
                                  <h2 class="heading">
                                    <a href="#" data-toggle="collapse" data-target="#collapse-<%= industry.id %>">
                                      <%= industry.title %>
                                      (<%= job_counts[i] %>)
                                    </a>
                                  </h2>
                                  <div id="collapse-<%= industry.id %>" class="collapse-panel collapse show">
                                    <div class="box-job box-job-dashboard">
                                      <ul>
                                        <% industry.jobs.each do |job| %>
                                          <li style="width: 265px;">
                                            <% users = UserJob.all.collect {|k| k.job_ids.include?(job.id) ? User.find(k.user_id) : []}.flatten %>
                                              <% user = users.first %>
                                                <% next unless user.present? %>
                                                  <% resume = user.resumes.first %>
                                                    <div class="equal">
                                                      <div class="box-heading">
                                                        <div class="box-header">
                                                          <div class="name">
                                                            <%= user.first_name[0] %>
                                                            <% if user.last_name %><%= user.last_name[0] %>
                                                            <% end %>
                                                          </div>
                                                          <div class="detail">
                                                            <h2 class="job-heading">
                                                              <%= link_to "#{user.first_name} #{user.last_name}", job_path(job) %>
                                                            </h2>
                                                            <h3 class="job-sub-heading">
                                                              <a href="mailto:<%= user.email %>"><%= user.email %></a>
                                                            </h3>
                                                            <% if resume.present? %>
                                                              <div class="about-job">
                                                                <%= link_to "#{resume.cv_file_name}".humanize, download_resume_path(resume), target: "_blank"%>
                                                              </div>
                                                            <% end %>
                                                          </div>
                                                        </div>
                                                        <div class="job-option text-center float-right">
                                                          <a href="#" id="options" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                            <ul>
                                                              <li></li>
                                                              <li></li>
                                                              <li></li>
                                                            </ul>
                                                          </a>
                                                          <div class="dropdown-menu" aria-labelledby="options">
                                                            <%= link_to 'Create interview', job_path(job), class: "dropdown-item" %>
                                                            <% if job.open? %>
                                                              <%= link_to 'Close the job', close_job_path(id: job.id), class: 'dropdown-item jobs-action', id: "job_#{job.id}" %>
                                                            <% else %>
                                                              <%= link_to 'Open the job', open_job_path(id: job.id), class: 'dropdown-item jobs-action', id: "job_#{job.id}" %>
                                                            <% end %>
                                                          </div>
                                                        </div>
                                                      </div>
                                                      <div class="job-discription">
                                                        <div class="hori-divi"></div>
                                                        <h3>Interview notes &nbsp;&nbsp;<a href="#"><%= link_to 'Edit', '#' %></a>
                                                        </h3>
                                                        <p><%= job.description %></p>
                                                      </div>
                                                    </div>
                                                    <div class="box-footer">
                                                      <ul class="d-block">
                                                        <h3>Interview schedule &nbsp;&nbsp;&nbsp;<%= link_to 'view', '#' %>
                                                        </h3>
                                                        <div class="stepwizard">
                                                          <div class="stepwizard-row">
                                                            <div class="stepwizard-step">
                                                              <button type="button" class="btn btn-default btn-circle">
                                                                <i class="fas fa-check"></i>
                                                              </button>
                                                              <p>1st</p>
                                                            </div>
                                                            <div class="stepwizard-step">
                                                              <button type="button" class="btn btn-circle">
                                                                <i class="fas fa-check"></i>
                                                              </button>
                                                              <p>2nd</p>
                                                            </div>
                                                            <div class="stepwizard-step">
                                                              <button type="button" class="btn btn-default btn-circle" disabled="disabled"></button>
                                                              <p>3rd</p>
                                                            </div>
                                                          </div>
                                                        </div>
                                                      </ul>
                                                    </div>
                                                  </li>
                                                <% end %>
                                              </ul>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  <% end %>
                                <% end %>
                              </div>
                            <% end %>
                          </div>

                          <div id="myModalMeeting" class="modal">
                            <div class="modal-content">
                              <span class="close">&times;</span>
                              <%= render partial: "interview_schedules/meeting" %>
                            </div>
                          </div>

                          <script type="text/javascript">
                            var modal = document.getElementById('myModalMeeting');
                            var btn = document.getElementById("myBtn");
                            var span = document.getElementsByClassName("close")[0];

                            $(document).ready(function () {
                              $('[data-toggle="tooltip"]').tooltip();
                            });

                            function meeting_with(id, result) {

                              $("#myModalMeeting").show()
                              $("#review_id").val(id)
                              $("#meeting").val(result)
                            }

                            $(document).ready(function () {
                              $('.close').click(function () {
                                $('.modal .avail_date').closest('.form-group').remove()
                                $('.modal').hide()
                              })
                            })

                            span.onclick = function () {
                              modal.style.display = "none";
                            }
                            window.onclick = function (event) {
                              if (event.target == modal) {
                                $('.modal').hide()
                              }
                            }
                          </script>
                          <style type="text/css">
                            .td_align {
                              text-align: center;
                            }
                            .table.table-bordered td a {
                              display: block;
                            }
                            #myBtn {
                              background: none!important;
                              border: none;
                              padding: 0!important !important;
                              font: inherit;
                              border-bottom: 1px solid #444;
                              cursor: pointer;
                              color: black;
                            }

                            .modal {
                              display: none;
                              /* Hidden by default */
                              position: fixed;
                              /* Stay in place */
                              z-index: 1;
                              /* Sit on top */
                              left: 0;
                              top: 0;
                              width: 100%;
                              /* Full width */
                              height: 100%;
                              /* Full height */
                              overflow: auto;
                              /* Enable scroll if needed */
                              background-color: rgb(0,0,0);
                              /* Fallback color */
                              background-color: rgba(0,0,0,0.4);
                              /* Black w/ opacity */
                            }
                            .modal-content {
                              background-color: #fefefe;
                              margin: 5% auto;
                              /* 15% from the top and centered */
                              padding: 20px;
                              border: 1px solid #888;
                              height: 500px;
                              width: 80%;
                              /* Could be more or less, depending on screen size */
                            }
                            .close {
                              color: #aaa;
                              float: right;
                              font-size: 28px;
                              font-weight: bold;
                            }
                            .close:focus,
                            .close:hover {
                              color: black;
                              text-decoration: none;
                              cursor: pointer;
                            }
                          </style>
